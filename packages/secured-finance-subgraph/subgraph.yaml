specVersion: 0.0.2
description: Secured Finance is decentralized P2P banking business for digital assets 
repository: https://github.com/secured-finance/secured-finance-subgraph
schema:
  file: ./schema.graphql
dataSources:
  - kind: ethereum/contract
    name: LoanV2
    network: ropsten
    source:
      address: '0x884254b0fc1e7bF2fE14177CFd63fd4f50a93528'
      abi: LoanV2
      startBlock: 12164567
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      entities:
        - Loan
        - LoanSchedule
        - SchedulePayment
      abis:
        - name: LoanV2
          file: ./abis/LoanV2.json
      eventHandlers:
        - event: Register(indexed address,indexed address,bytes32,uint256,uint256,uint256,indexed bytes32)
          handler: handleLoanRegister
        - event: RequestTermination(bytes32,indexed address)
          handler: handleLoanTerminationRequest
        - event: RejectTermination(bytes32,indexed address)
          handler: handleLoanTerminationRejection
        - event: EarlyTermination(bytes32,indexed address,uint256)
          handler: handleLoanEarlyTermination
        - event: MarkToMarket(bytes32,uint256,uint256)
          handler: handleLoanMarkToMarket
        - event: Novation(indexed bytes32,address)
          handler: handleLoanNovation
        - event: Liquidate(bytes32)
          handler: handleLoanLiquidation
      file: ./src/loan.ts
  - kind: ethereum/contract
    name: TermStructure
    network: ropsten
    source:
      address: '0xB6AD6A3a356f208832e46aF4409e59B53287E44E'
      abi: TermStructure
      startBlock: 12164567
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      entities:
        - Term
      abis:
        - name: TermStructure
          file: ./abis/TermStructure.json
      eventHandlers:
        - event: TermAdded(uint256)
          handler: handleNewTerm
        - event: ProductTermSupportUpdated(uint256,bytes4,bytes32,bool)
          handler: handleTermProductSupport
      file: ./src/terms.ts
  - kind: ethereum/contract
    name: ProductAddressResolver
    network: ropsten
    source:
      address: '0x3Bb006345DA94AA05BEBD0Ec70CBe6f28A017cEe'
      abi: ProductAddressResolver
      startBlock: 12164567
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      entities:
        - Product
      abis:
        - name: ProductAddressResolver
          file: ./abis/ProductAddressResolver.json
      eventHandlers:
        - event: RegisterProduct(bytes4,indexed address,indexed address)
          handler: handleNewProduct
      file: ./src/product-resolver.ts
  - kind: ethereum/contract
    name: CurrencyController
    network: ropsten
    source:
      address: '0x8682Fa83785B7F51A14101122CCb1DCb4A247B80'
      abi: CurrencyController
      startBlock: 12164567
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      entities:
        - Term
      abis:
        - name: CurrencyController
          file: ./abis/CurrencyController.json
      eventHandlers:
        - event: CcyAdded(indexed bytes32,string,uint16,uint256)
          handler: handleNewCurrency
        - event: LTVUpdated(indexed bytes32,uint256)
          handler: handleCurrencyLTVUpdate
        - event: MinMarginUpdated(indexed bytes32,uint256)
          handler: handleCurrencyMinMarginUpdate
        - event: CcySupportUpdate(indexed bytes32,bool)
          handler: handleCurrencySupportUpdate
        - event: CcyCollateralUpdate(indexed bytes32,bool)
          handler: handleCurrencyCollateralSupportUpdate
        - event: PriceFeedAdded(bytes32,string,indexed address)
          handler: handleCurrencyPriceFeed
        - event: PriceFeedRemoved(bytes32,string,indexed address)
          handler: handleCurrencyPriceFeedRemove
      file: ./src/currency-controller.ts
  - kind: ethereum/contract
    name: CloseOutNetting
    network: ropsten
    source:
      address: '0xB26348D051da2dd8AE9402b3E3060A48F632114e'
      abi: CloseOutNetting
      startBlock: 12164567
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      entities:
        - CloseOutNetting
      abis:
        - name: CloseOutNetting
          file: ./abis/CloseOutNetting.json
      eventHandlers:
        - event: AddCloseOutPayments(indexed address,indexed address,bytes32,uint256,uint256)
          handler: handleCloseOutPaymentIncrease
        - event: RemoveCloseOutPayments(indexed address,indexed address,bytes32,uint256,uint256)
          handler: handleCloseOutPaymentDecrease
      file: ./src/close-out-netting.ts
  - kind: ethereum/contract
    name: PaymentAggregator
    network: ropsten
    source:
      address: '0xbf5c6641ab47307F48Ca74644011B8a76e37241b'
      abi: PaymentAggregator
      startBlock: 12164567
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      entities:
        - TimeSlot
      abis:
        - name: PaymentAggregator
          file: ./abis/PaymentAggregator.json
      eventHandlers:
        - event: RegisterPayment(indexed address,indexed address,bytes32,bytes32,uint256,uint256,uint256,uint256,uint256)
          handler: handleTimeSlotPaymentIncrease
        - event: RemovePayment(indexed address,indexed address,bytes32,bytes32,uint256,uint256,uint256,uint256,uint256)
          handler: handleTimeSlotPaymentDecrease
        - event: VerifyPayment(indexed address,indexed address,bytes32,bytes32,uint256,uint256,uint256,uint256,bytes32)
          handler: handleTimeSlotPaymentVerification
        - event: SettlePayment(indexed address,indexed address,bytes32,bytes32,uint256,uint256,uint256,bytes32)
          handler: handleTimeSlotPaymentSettlement
      file: ./src/payment-aggregator.ts
  - kind: ethereum/contract
    name: CollateralAggregator
    network: ropsten
    source:
      address: '0x74B405Ec5dC45e5c7ea9d581D4A3907e60B724d4'
      abi: CollateralAggregator
      startBlock: 12164567
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      entities:
        - CollateralAggregator
        - CollateralVault
        - CollateralUserContract
        - CollateralPosition
        - BilateralPosition
        - CollateralNetting
      abis:
        - name: CollateralAggregator
          file: ./abis/CollateralAggregator.json
      eventHandlers:
        - event: Register(indexed address)
          handler: handleCollateralAggregatorRegistration
        - event: UseUnsettledCollateral(indexed address,bytes32,uint256)
          handler: handleCollateralUnsettledUse
        - event: ReleaseUnsettled(indexed address,bytes32,uint256)
          handler: handleCollateralUnsettledRelease
        - event: UseCollateral(indexed address,indexed address,bytes32,uint256,uint256,bool)
          handler: handleCollateralPositionUse
        - event: Release(indexed address,indexed address,bytes32,uint256,uint256,bool)
          handler: handleCollateralPositionRelease
        - event: SettleCollateral(indexed address,indexed address,bytes32,uint256,uint256)
          handler: handleCollateralPositionSettle
        - event: UpdatePV(indexed address,indexed address,bytes32,uint256,uint256,uint256,uint256)
          handler: handleCollateralPositionUpdatePV
        - event: LiquidationPriceUpdated(uint256,uint256)
          handler: handleCollateralLiquidationPriceUpdate
        - event: MarginCallThresholdUpdated(uint256,uint256)
          handler: handleCollateralMarginCallUpdate
        - event: MinCollateralRatioUpdated(uint256,uint256)
          handler: handleCollateralMinCollateralRatioUpdate
        - event: AutoLiquidationThresholdUpdated(uint256,uint256)
          handler: handleCollateralAutoLiquidationRatioUpdate
        - event: CollateralUserAdded(indexed address)
          handler: handleCollateralUserAdded
        - event: CollateralUserRemoved(indexed address)
          handler: handleCollateralUserRemoved
        - event: CollateralVaultLinked(indexed address,bytes32,address)
          handler: handleCollateralVaultLinked
        - event: CollateralVaultRemoved(indexed address,bytes32,address)
          handler: handleCollateralVaultRemoved
      file: ./src/collateral-aggregator.ts
  - kind: ethereum/contract
    name: LendingMarketController
    network: ropsten
    source:
      address: '0x80143B3C92b635cF8A5892899a6634eEE731cff5'
      abi: LendingMarketController
      startBlock: 12164567
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      entities:
        - LendingMarketController
      abis:
        - name: LendingMarketController
          file: ./abis/LendingMarketController.json
      eventHandlers:
        - event: LendingMarketCreated(bytes32,uint256,indexed address)
          handler: handleNewLendingMarket
      file: ./src/lendingController.ts
  - kind: ethereum/contract
    name: CrosschainAddressResolver
    network: ropsten
    source:
      address: '0x93E72CE258eB0a47aC0de06f012162afa5D84f15'
      abi: CrosschainAddressResolver
      startBlock: 12164567
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      entities:
        - CrosschainAddress
      abis:
        - name: CrosschainAddressResolver
          file: ./abis/CrosschainAddressResolver.json
      eventHandlers:
        - event: UpdateAddress(address,uint256,string)
          handler: handleCrosschainAddressUpdate
      file: ./src/crosschain-address-resolver.ts
templates:
  - kind: ethereum/contract
    name: LendingMarket
    network: ropsten
    source:
      abi: LendingMarket
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      entities:
        - LendingMarket
        - LendingMarketOrderRow
        - LendingMarketOrderItem
        - FilledLendingMarketOrder
      abis:
        - name: LendingMarket
          file: ./abis/LendingMarket.json
      eventHandlers:
        - event: MakeOrder(uint256,indexed address,uint8,bytes32,uint256,uint256,uint256)
          handler: handleMakeLendingOrder
        - event: TakeOrder(uint256,indexed address,uint8,uint256,uint256)
          handler: handleTakeLendingOrder
        - event: CancelOrder(uint256,indexed address,uint8,uint256,uint256)
          handler: handleCancelLendingOrder
      file: ./src/lendingMarket.ts
  - kind: ethereum/contract
    name: CollateralVault
    network: ropsten
    source:
      abi: CollateralVault
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      entities:
        - CollateralVault
      abis:
        - name: CollateralVault
          file: ./abis/CollateralVault.json
      eventHandlers:
        - event: Deposit(address,uint256)
          handler: handleCollateralVaultDeposit
        - event: PositionWithdraw(address,address,uint256)
          handler: handleCollateralVaultDepositInPosition
        - event: Withdraw(address,uint256)
          handler: handleCollateralVaultWithdraw
        - event: PositionWithdraw(address,address,uint256)
          handler: handleCollateralVaultWithdrawFromPosition
        - event: Liquidate(address,address,uint256)
          handler: handleCollateralVaultLiquidation
        - event: LiquidateIndependent(address,address,uint256)
          handler: handleCollateralVaultLiquidationIndependent
        - event: RebalanceTo(address,address,uint256)
          handler: handleCollateralVaultRebalanceTo
        - event: RebalanceFrom(address,address,uint256)
          handler: handleCollateralVaultRebalanceFrom
        - event: RebalanceBetween(address,address,address,uint256)
          handler: handleCollateralVaultRebalanceBetween
      file: ./src/collateral-vault.ts

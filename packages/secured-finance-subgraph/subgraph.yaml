specVersion: 0.0.2
description: Secured Finance is decentralized P2P banking business for digital assets 
repository: https://github.com/secured-finance/secured-finance-subgraph
schema:
  file: ./schema.graphql
dataSources:
  - kind: ethereum/contract
    name: LoanV2
    network: mainnet
    source:
      address: '0x05b22c7FD08CC68Fd0866b2b1004F3295e69Aa42'
      abi: LoanV2
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      entities:
        - Loan
        - LoanSchedule
        - SchedulePayment
      abis:
        - name: LoanV2
          file: ./abis/LoanV2.json
      eventHandlers:
        - event: Register(indexed address,indexed address,bytes32,uint256,uint256,uint256,indexed bytes32)
          handler: handleLoanRegister
        - event: RequestTermination(bytes32,indexed address)
          handler: handleLoanTerminationRequest
        - event: RejectTermination(bytes32,indexed address)
          handler: handleLoanTerminationRejection
        - event: EarlyTermination(bytes32,indexed address,uint256)
          handler: handleLoanEarlyTermination
        - event: MarkToMarket(bytes32,uint256,uint256)
          handler: handleLoanMarkToMarket
        - event: Novation(indexed bytes32,address)
          handler: handleLoanNovation
        - event: Liquidate(bytes32)
          handler: handleLoanLiquidation
      file: ./src/loan.ts
  - kind: ethereum/contract
    name: TermStructure
    network: mainnet
    source:
      address: '0x4c44f15fd2e79C9819024FEf9452042d2df2de26'
      abi: TermStructure
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      entities:
        - Term
      abis:
        - name: TermStructure
          file: ./abis/TermStructure.json
      eventHandlers:
        - event: TermAdded(uint256,uint256,uint256)
          handler: handleNewTerm
        - event: ProductTermSupportUpdated(uint256,bytes4,bytes32,bool)
          handler: handleTermProductSupport
      file: ./src/terms.ts
  - kind: ethereum/contract
    name: ProductAddressResolver
    network: mainnet
    source:
      address: '0x444f310468a3735F3453e982c62E1e99C95f3ff3'
      abi: ProductAddressResolver
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      entities:
        - Product
      abis:
        - name: ProductAddressResolver
          file: ./abis/ProductAddressResolver.json
      eventHandlers:
        - event: RegisterProduct(bytes4,indexed address,indexed address)
          handler: handleNewProduct
      file: ./src/product-resolver.ts
  - kind: ethereum/contract
    name: CurrencyController
    network: mainnet
    source:
      address: '0x70b4bff41C2Eb94F44333A1f118937c9064D2Ca6'
      abi: CurrencyController
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      entities:
        - Term
      abis:
        - name: CurrencyController
          file: ./abis/CurrencyController.json
      eventHandlers:
        - event: CcyAdded(indexed bytes32,string,uint16,uint256)
          handler: handleNewCurrency
        - event: LTVUpdated(indexed bytes32,uint256)
          handler: handleCurrencyLTVUpdate
        - event: MinMarginUpdated(indexed bytes32,uint256)
          handler: handleCurrencyMinMarginUpdate
        - event: CcySupportUpdate(indexed bytes32,bool)
          handler: handleCurrencySupportUpdate
        - event: CcyCollateralUpdate(indexed bytes32,bool)
          handler: handleCurrencyCollateralSupportUpdate
        - event: PriceFeedAdded(bytes32,string,indexed address)
          handler: handleCurrencyPriceFeed
        - event: PriceFeedRemoved(bytes32,string,indexed address)
          handler: handleCurrencyPriceFeedRemove
      file: ./src/currency-controller.ts
  - kind: ethereum/contract
    name: CloseOutNetting
    network: mainnet
    source:
      address: '0xAb45660e1902202DFA375f44E82279EFE9f7854E'
      abi: CloseOutNetting
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      entities:
        - CloseOutNetting
      abis:
        - name: CloseOutNetting
          file: ./abis/CloseOutNetting.json
      eventHandlers:
        - event: AddCloseOutPayments(indexed address,indexed address,bytes32,uint256,uint256)
          handler: handleCloseOutPaymentIncrease
        - event: RemoveCloseOutPayments(indexed address,indexed address,bytes32,uint256,uint256)
          handler: handleCloseOutPaymentDecrease
      file: ./src/close-out-netting.ts
  - kind: ethereum/contract
    name: PaymentAggregator
    network: mainnet
    source:
      address: '0x0c824b1a58618951De386DE6B2D3c575f8cd3822'
      abi: PaymentAggregator
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      entities:
        - TimeSlot
      abis:
        - name: PaymentAggregator
          file: ./abis/PaymentAggregator.json
      eventHandlers:
        - event: RegisterPayment(indexed address,indexed address,bytes32,bytes32,uint256,uint256,uint256,uint256,uint256)
          handler: handleTimeSlotPaymentIncrease
        - event: RemovePayment(indexed address,indexed address,bytes32,bytes32,uint256,uint256,uint256,uint256,uint256)
          handler: handleTimeSlotPaymentDecrease
        - event: VerifyPayment(indexed address,indexed address,bytes32,bytes32,uint256,uint256,uint256,uint256,bytes32)
          handler: handleTimeSlotPaymentVerification
        - event: SettlePayment(indexed address,indexed address,bytes32,bytes32,uint256,uint256,uint256,bytes32)
          handler: handleTimeSlotPaymentSettlement
      file: ./src/payment-aggregator.ts
  # - kind: ethereum/contract
  #   name: Collateral
  #   network: mainnet
  #   source:
  #     address: '0x86D971F85Be1f6e3C1b1E41d74104560e9e2040d'
  #     abi: Collateral
  #     startBlock: 10026125
  #   mapping:
  #     kind: ethereum/events
  #     apiVersion: 0.0.6
  #     language: wasm/assemblyscript
  #     entities:
  #       - Collateral
  #     abis:
  #       - name: Collateral
  #         file: ./abis/Collateral.json
  #     eventHandlers:
  #       - event: SetColBook(indexed address,indexed string,bytes32,address)
  #         handler: handleSetCollateralBook
  #       - event: UpSizeETH(indexed address)
  #         handler: handleUpSizeETH
  #       - event: UpSizeFIL(indexed address,uint256,bytes32)
  #         handler: handleUpSizeFIL
  #       - event: ConfirmUpSizeFIL(indexed address,indexed bytes32,uint256,indexed bytes32)
  #         handler: handleConfirmUpSizeFIL
  #       - event: DelColBook(indexed address)
  #         handler: handleDeleteCollateralBook
  #       - event: PartialLiquidation(indexed address,indexed address,indexed uint256,uint8)
  #         handler: handlePartialLiquidation
  #     file: ./src/collateral.ts
  - kind: ethereum/contract
    name: LendingMarketController
    network: mainnet
    source:
      address: '0x0d1a99841ae744556D6397826F2d158993287947'
      abi: LendingMarketController
      # startBlock: 10026125
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      entities:
        - LendingMarketController
      abis:
        - name: LendingMarketController
          file: ./abis/LendingMarketController.json
      eventHandlers:
        - event: LendingMarketCreated(bytes32,uint256,indexed address)
          handler: handleNewLendingMarket
      file: ./src/lendingController.ts
templates:
  - kind: ethereum/contract
    name: LendingMarket
    network: mainnet
    source:
      abi: LendingMarket
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      entities:
        - LendingMarket
        - LendingMarketOrderRow
        - LendingMarketOrderItem
        - FilledLendingMarketOrder
      abis:
        - name: LendingMarket
          file: ./abis/LendingMarket.json
      eventHandlers:
        - event: MakeOrder(uint256,indexed address,uint8,bytes32,uint256,uint256,uint256)
          handler: handleMakeLendingOrder
        - event: TakeOrder(uint256,indexed address,uint8,uint256,uint256)
          handler: handleTakeLendingOrder
        - event: CancelOrder(uint256,indexed address,uint8,uint256,uint256)
          handler: handleCancelLendingOrder
      file: ./src/lendingMarket.ts
